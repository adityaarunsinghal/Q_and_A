---
title: "exp3_analysis"
output: html_document
---

First, import data

```{r}
# Restricted answer space (x is at gate y)
d0 = read.csv("q_and_a3-trials.tsv", sep = '\t')
# Free response answer space
d1 = read.csv("../../experiment3_fr/data/q_and_a3_fr-trials.tsv", sep = '\t')
```

We begin by analyzing the 'question' part of the experiment. Extract the question items.

```{r}
d0_q = subset(d0, trial_type == 'question', select=c(workerid, qud, response))
d1_q = subset(d1, trial_type == 'question', select=c(workerid, qud, response))
d1_q$response = factor(d1_q$response)
pooled_qs = rbind(d0_q, d1_q)
str(pooled_qs)
```

Now, for a given qud, we want to know the distribution of questions asked (could be pooled with data from other versions, since this was the same in all). This part of the experiment was the same for the two versions, hence we pool them together.

```{r}
new_labels = sapply(X = pooled_qs$qud, FUN = function(v) {return(paste("qud:", v))})
pooled_qs$facet_label = new_labels
g4<-ggplot(pooled_qs, aes(x=response)) + geom_histogram(color="black", fill='black')
g4 + facet_wrap(~qud)
```



Next, we evaluate the answers:

Note that participants always tell the truth -- the gate they give always matches the true location of the item they give.

```{r}
d0_a = subset(d0, trial_type == 'ans:', 
              select=c(workerid, utterance, world_state, gate_response, item_response))
d0_a$world_state = strsplit(as.character(d0_a$world_state), split = ',')
for(i in 1:dim(d0_a)[1]){
  d0_a$telling_truth = d0_a$gate_response[i] == match(tolower(d0_a$item_response[i]), 
                                                      d0_a$world_state[i][[1]])
}
```

This justifies just looking at the item they give:

```{r}
new_labels = sapply(X = d0_a$utterance, FUN = function(v) {return(paste("utterance:", v))})
d0_a$facet_label = new_labels
g4<-ggplot(d0_a, aes(x=item_response)) + geom_histogram(color="black", fill='black')
g4 + facet_wrap(~facet_label)
```

Now, for the harder to parse data:

```{r}
d1_a = subset(d1, trial_type == 'ans:', 
              select=c(workerid, utterance, world_state, response))
d1_a$world_state = strsplit(as.character(d1_a$world_state), split = ',')
for(i in 1:dim(d1_a)[1]){
  # 1. Extract numbers from unstructured text
  raw_response <- as.character(d1_a$response[i])
  gr <- as.character(gsub("[^0-9]", "", unlist(raw_response)))
  d1_a$gate_response[i] = gr
  # 2. Figure out which item was behind this gate 
  if(nchar(gr) == 1) {
    item_response <- d1_a$world_state[i][[1]][as.numeric(gr)] 
  } else 
    item_response <- "mult gates"
  d1_a$item_response[i] = item_response
}
```

Now plot these answers... Note that we collapsed together a participant giving multiple gates (e.g. "a thing is behind gates 1,2,3,and 4")

```{r}
new_labels = sapply(X = d1_a$utterance, FUN = function(v) {return(paste("utterance:", v))})
d1_a$facet_label = new_labels
g4<-(ggplot(d1_a, aes(x=item_response)) 
     + geom_histogram(color="black", na.rm = T, fill='black')
     + facet_wrap(~facet_label) 
     + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)))
g4
```

Most of the multiple responses appear in 'dog' and 'animal'. 

Otherwise, it's pretty cool that even for vague questions like 'where is a thing?' almost everyone gave the exact location of the flower (without even specifying *what* is behind that gate). Just "which gate has a thing behind it?" -> "gate 3". A bit curious whether 'thing' became a label for the flower, or whether they reasoned it out in full... 

If you take out the multiple gate references, this is the same result as the non-free form version. 



